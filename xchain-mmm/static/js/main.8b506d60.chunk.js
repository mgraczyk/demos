(this.webpackJsonpdemo=this.webpackJsonpdemo||[]).push([[0],{22:function(e,t,n){},23:function(e,t,n){},26:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n.n(r),s=n(12),i=n.n(s),c=(n(22),n(5)),o=n(13),l=n(14),u=n(7),d=n(17),h=n(16),m=n(11),b=n(1),j=n(8),p=(n(23),n(10)),f=n.n(p),O=n(15),v="__rus",g=function(e){return new Promise((function(t){return setTimeout(t,e)}))},x=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,r=0,a=0;return Object(O.a)(f.a.mark((function s(){var i,c,o,l,u,d,h=arguments;return f.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(i=r+=1,!((c=a+n-performance.now())>0)){s.next=5;break}return s.next=5,g(c);case 5:if(r===i){s.next=7;break}return s.abrupt("return");case 7:for(a=performance.now(),o=null,l=h.length,u=new Array(l),d=0;d<l;d++)u[d]=h[d];if(!e){s.next=14;break}return s.next=13,e.apply(void 0,u);case 13:o=s.sent;case 14:r===i&&t&&t(o,u);case 15:case"end":return s.stop()}}),s)})))};function A(e){var t=new URLSearchParams(window.location.search),n=function(e){return window.btoa(JSON.stringify(e))}(e);t.set(v,n),window.history.replaceState(null,null,"".concat(window.location.pathname,"?").concat(t))}function B(){return function(e){if(!e)return null;try{return JSON.parse(window.atob(e))}catch(t){return console.error(t),null}}(new URLSearchParams(window.location.search).get(v))||{}}var F=n(0);function I(e){var t=e.sends;return Object(F.jsxs)("ul",{children:[0===t.length&&Object(F.jsx)("span",{children:"No Sends"}),t.map((function(e){var t;return Object(F.jsx)("li",{children:Object(F.jsxs)("span",{children:["id=",e.id,", value=",null!==(t=e.valueIn)&&void 0!==t?t:"??"]})},e.id)}))]})}var y=function(e){var t=e.sendsFromA,n=e.sendsFromB;return Object(F.jsxs)("div",{children:[Object(F.jsx)("h3",{children:"Transfers"}),Object(F.jsx)("h4",{children:"From A to B"}),Object(F.jsx)(I,{sends:t}),Object(F.jsx)("h4",{children:"From B to A"}),Object(F.jsx)(I,{sends:n})]})};n(2);function w(e){var t=e.sequences,n=e.errorMessage,r=n?Object(F.jsx)("span",{className:"curve-error",children:n}):Object(F.jsxs)("div",{children:[0===t.length&&Object(F.jsx)("span",{children:"No Sequences"}),t.slice(0,1e3).map((function(e){return Object(F.jsx)("div",{children:Object(F.jsx)("textarea",{readOnly:!0,style:{width:"100%",height:"450px"},value:JSON.stringify(e,"\n","  ")})},e.id)}))]});return Object(F.jsxs)("div",{children:[Object(F.jsx)("h3",{children:"Sequences"}),r]})}function S(e,t,n,r,a){var s,i={balance:n,remoteBalance:r,K:a},c={balance:r,remoteBalance:n,K:a},o={},l=[{stateA:Object(b.a)({},i),stateB:Object(b.a)({},c)}],u=[],d=Object(j.a)(t);try{for(d.s();!(s=d.n()).done;){var h=s.value,m=h.id,p=h.valueIn,f=h.fromA,O=h.isStart,v=O&&f||!O&&!f,g=v?i:c;if(O){u.push({id:m,currency:v?"A":"B",amount:-p});var x=p;g.balance+=x;var A=g.remoteBalance-a/g.balance;g.remoteBalance-=A,o[m]={amountReceived:x,amountSent:A}}else{var B=o[m],F=B.amountSent,I=B.amountReceived;g.remoteBalance+=I,g.balance-=F,u.push({id:m,currency:v?"A":"B",amount:F})}l.push({stateA:Object(b.a)({},i),stateB:Object(b.a)({},c)})}}catch(R){d.e(R)}finally{d.f()}for(var y={},w=0,S=u;w<S.length;w++){var C,N,k=S[w],E=k.id,K=k.currency,q=k.amount;y[E]=null!==(C=y[E])&&void 0!==C?C:{},y[E][K]=(null!==(N=y[E][K])&&void 0!==N?N:0)+q}return{ordering:t.map((function(e){var t=e.fromA,n=e.isStart;return t?n?"A":"a":n?"B":"b"})).join(""),stateA:i,stateB:c,transfersById:y,bridgeTxns:o,statePairs:l,id:e}}var C={reconciled:!1,initialA:"500",initialB:"550",sendsFromAInput:"20,50",sendsFromBInput:"50,100",orderingsInput:"AABBaabb\nAABBbbaa\nAaAaBbBb\nAAaaBBbb",orderingsError:null,K:null,sendsFromA:[],sendsFromB:[],sequences:[]},N=["initialA","initialB","sendsFromAInput","sendsFromBInput","orderingsInput"],k=function(e,t,n){var r=e.replace(/[^ABab]/g,"");if(0===r.length)return[null,null];var a,s=0,i=0,c=[],o=[],l=[],u=Object(j.a)(r);try{for(u.s();!(a=u.n()).done;){var d=a.value;if("A"===d){if(s>=t.length)return[null,'Too many "A" characters'];var h=t[s];c.push(h),s+=1,l.push(Object(b.a)(Object(b.a)({},h),{},{isStart:!0}))}else if("B"===d){if(i>=n.length)return[null,'Too many "B" characters'];var m=n[i];o.push(m),i+=1,l.push(Object(b.a)(Object(b.a)({},m),{},{isStart:!0}))}else if("a"===d){if(0===c.length)return[null,'Too many "a" characters'];var p=c.pop();l.push(Object(b.a)(Object(b.a)({},p),{},{isEnd:!0}))}else if("b"===d){if(0===o.length)return[null,'Too many "b" characters'];var f=o.pop();l.push(Object(b.a)(Object(b.a)({},f),{},{isEnd:!0}))}}}catch(O){u.e(O)}finally{u.f()}return c.length?[null,'Not enough "a" characters']:o.length?[null,'Not enough "b" characters']:s!==t.length?[null,'Not enough "A" characters']:i!==n.length?[null,'Not enough "B" characters']:[l,null]},E=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state=C,r.handleChange=function(e){var t;r.setState((t={},Object(c.a)(t,e.target.name,e.target.value),Object(c.a)(t,"reconciled",!1),t))},r.reconcile=function(){var e=Object(u.a)(r).state;if(!e.reconciled){var t,n=function(e,t){return e.split(",").filter((function(e){return e.length})).map((function(e){return Number(e)}))},a=n(e.sendsFromAInput).map((function(e,t){return{id:"A.".concat(t),fromA:!0,valueIn:e}})),s=n(e.sendsFromBInput).map((function(e,t){return{id:"B.".concat(t),fromB:!0,valueIn:e}})),i=Number(e.initialA),c=Number(e.initialB),o=i*c,l=function(e,t,n){for(var r=e.split(/\r?\n/),a=[],s=0;s<r.length;++s){var i=k(r[s],t,n),c=Object(m.a)(i,2),o=c[0],l=c[1];if(l)return[null,"Line ".concat(s,": ").concat(l)];o&&a.push(o)}return[a,null]}(e.orderingsInput,a,s),d=Object(m.a)(l,2),h=d[0],b=d[1];b||(t=h.map((function(e,t){return S(t,e,i,c,o)}))),r.setState({reconciled:!0,K:o,sendsFromA:a,sendsFromB:s,sequences:t,orderingsError:b})}},r.reset=function(){r.setState(C,r.reconcile)},r.putStateInUrl=function(){return x(null,(function(e,t){return A(t[0])}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:500)}(1e3),r.unbouncedReconcile=x(r.reconcile,null,500),r}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=B();this.setState(Object(b.a)(Object(b.a)({},this.state),e))}},{key:"componentDidUpdate",value:function(e,t,n){var r=this;this.state!==t&&(this.putStateInUrl(Object.fromEntries(N.map((function(e){return[e,r.state[e]]})))),this.unbouncedReconcile())}},{key:"render",value:function(){return Object(F.jsxs)("div",{className:"App",children:[Object(F.jsx)("h2",{children:"Computation"}),Object(F.jsxs)("div",{className:"curve-form",children:[Object(F.jsx)("span",{children:"\xa0"}),Object(F.jsx)("button",{onClick:this.reset,style:{width:"5em"},children:"Reset"}),Object(F.jsx)("label",{htmlFor:"initialA",children:"Initial A:"}),Object(F.jsx)("input",{type:"text",name:"initialA",id:"initialA",autoComplete:"off",value:this.state.initialA,onChange:this.handleChange}),Object(F.jsx)("label",{htmlFor:"initialB",children:"Initial B:"}),Object(F.jsx)("input",{type:"text",name:"initialB",id:"initialB",autoComplete:"off",value:this.state.initialB,onChange:this.handleChange}),Object(F.jsx)("label",{htmlFor:"K",children:"K:"}),Object(F.jsx)("span",{id:"K",children:this.state.K}),Object(F.jsx)("label",{htmlFor:"sendsFromAInput",children:"Send Amounts From A (comma separated):"}),Object(F.jsx)("input",{type:"text",name:"sendsFromAInput",id:"sendsFromAInput",autoComplete:"off",placeholder:"10,20,...",value:this.state.sendsFromAInput,onChange:this.handleChange}),Object(F.jsx)("label",{htmlFor:"sendsFromBInput",children:"Send Amounts From B (comma separated):"}),Object(F.jsx)("input",{type:"text",name:"sendsFromBInput",id:"sendsFromBInput",autoComplete:"off",placeholder:"10,50,...",value:this.state.sendsFromBInput,onChange:this.handleChange}),Object(F.jsxs)("label",{htmlFor:"orderingsInput",children:["Orderings.\xa0",Object(F.jsx)("em",{children:'"AaBb" means start send from A, then end send from A, then start send from B, then end etc. "ABba" means start send from A, then start send from B, then end send from b, then end from a.'})]}),Object(F.jsx)("textarea",{type:"text",name:"orderingsInput",id:"orderingsInput",className:"".concat(this.state.orderingsError?"curve-error":""),title:this.state.orderingsError,autoComplete:"off",placeholder:"AAAaBbaa..",value:this.state.orderingsInput,onChange:this.handleChange})]}),Object(F.jsx)("hr",{}),this.state.reconciled?Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(y,{sendsFromA:this.state.sendsFromA,sendsFromB:this.state.sendsFromB}),Object(F.jsx)(w,{errorMessage:this.state.orderingsError,sequences:this.state.sequences})]}):Object(F.jsx)("span",{children:"Computing..."})]})}}]),n}(a.a.Component);i.a.render(Object(F.jsx)(a.a.StrictMode,{children:Object(F.jsx)(E,{})}),document.getElementById("root"))}},[[26,1,2]]]);
//# sourceMappingURL=main.8b506d60.chunk.js.map